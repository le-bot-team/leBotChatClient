# Debug模式使用说明

## 概述

程序支持debug模式，用于输出详细的调试信息。在正常运行时，这些调试日志不会输出，以保持较好的性能和简洁的日志输出。

## 启用Debug模式

通过环境变量 `DEBUG=1` 来启用debug模式：

```bash
DEBUG=1 ./leBotChatClient
```

## Debug模式下的输出信息

### 1. 音频录制相关

- **设备初始化信息**
  ```
  使用录音设备: <设备名> (输入通道: <数量>, 默认采样率: <Hz>, 捕获采样率: <Hz>, 输出采样率: <Hz>)
  ```

- **录音开始/停止**
  ```
  开始录音 (设备: <设备名>, 捕获采样率: <Hz>, 输出采样率: <Hz>)
  停止录音
  ```

- **音频诊断信息**（每个音频块）
  ```
  音频诊断 - RMS: <值>, Peak: <值>, 静音比例: <百分比>%, 是否静音: <true/false>
  ```
  
  - **RMS (均方根)**：反映音频的平均能量级别
    - 语音通常在 500-5000 范围内
    - 如果 RMS < 200，可能是静音或噪音太小
  
  - **Peak (峰值)**：音频的最大振幅
    - 16位音频的最大值是 32767
    - 语音通常峰值在 1000-20000 范围内
  
  - **静音比例**：采样点中静音的百分比
    - 如果 > 95%，说明几乎是静音
    - 正常语音通常在 20-60% 之间

- **最后音频块诊断**
  ```
  最后音频块诊断 - RMS: <值>, Peak: <值>, 静音比例: <百分比>%, 是否静音: <true/false>, 样本数: <数量>
  发送最后的音频数据: <采样点数> 采样点
  ```

### 2. 音频发送相关

- **音频数据块发送**
  ```
  发送WAV音频数据块: <字节数> 字节
  ```

- **完成请求发送**
  ```
  发送完成请求(包含最后<字节数>字节WAV音频)
  发送完成请求(无剩余音频)
  ```

### 3. WebSocket通信相关

- **连接状态**
  ```
  WebSocket连接成功
  WebSocket连接已断开
  ```

- **配置更新**
  ```
  收到配置更新响应: Success=<true/false>, Message=<消息>
  更新请求已发送
  更新响应成功，开始流式录音发送
  ```

### 4. 服务器响应相关

- **音频流响应**
  ```
  收到音频流响应: ID=<请求ID>, 会话ID=<会话ID>, 对话ID=<对话ID>
  音频数据大小: <字节数> 字节
  音频输出完成: 会话ID=<会话ID>, 对话ID=<对话ID>
  ```

- **文本流响应**
  ```
  收到文本流: ID=<对话ID>, 角色=<角色>, 文本=<内容>
  文本输出完成: ID=<对话ID>, 角色=<角色>, 文本=<内容>
  ```

- **聊天完成**
  ```
  聊天完成: ID=<对话ID>, 成功=<true/false>, 消息=<消息>
  ```

- **打断逻辑**
  ```
  检测到用户新消息，执行打断逻辑
  ```

### 5. 音频播放相关

- **写入缓冲区**
  ```
  写入缓冲区: <字节数> 字节, 当前缓冲: <字节数> 字节
  ```

- **播放控制**
  ```
  开始播放...
  收到播放完成指令
  已清除音频缓冲区
  打断播放，停止音频流...
  播放结束
  音频播放已启动...
  ```

## 正常模式 vs Debug模式

### 正常模式（默认）
```bash
./leBotChatClient
```
- 只输出必要的日志（错误、警告、关键状态）
- 更好的性能
- 日志更简洁

### Debug模式
```bash
DEBUG=1 ./leBotChatClient
```
- 输出详细的调试信息
- 适合排查问题
- 可能有轻微的性能影响

## 使用场景

### 何时使用正常模式
- 生产环境运行
- 不需要详细日志
- 追求最佳性能

### 何时使用Debug模式
- **调试音频问题**：检查录音是否包含有效语音
- **排查通信问题**：查看WebSocket消息交互
- **分析播放问题**：跟踪音频播放流程
- **开发测试**：验证功能是否正常工作

## 注意事项

1. Debug模式会增加日志输出量，可能影响终端显示速度
2. 在生产环境建议关闭debug模式以获得最佳性能
3. 音频诊断信息每200ms输出一次（基于chunk duration配置）
